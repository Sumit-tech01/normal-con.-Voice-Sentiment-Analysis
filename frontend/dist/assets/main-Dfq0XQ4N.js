!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const e={connectionStatus:document.getElementById("connection-status"),btnRecordFile:document.getElementById("btn-record-file"),btnRecordMic:document.getElementById("btn-record-mic"),panelFileUpload:document.getElementById("panel-file-upload"),panelMicRecording:document.getElementById("panel-mic-recording"),btnStartRecording:document.getElementById("btn-start-recording"),btnStopRecording:document.getElementById("btn-stop-recording"),recordingStatus:document.getElementById("recording-status"),recordingDuration:document.getElementById("recording-duration"),recTime:document.getElementById("rec-time"),btnAnalyzeStream:document.getElementById("btn-analyze-stream"),audioVisualizer:document.getElementById("audio-visualizer"),dropZone:document.getElementById("drop-zone"),fileInput:document.getElementById("file-input"),fileInfo:document.getElementById("file-info"),fileName:document.getElementById("file-name"),fileSize:document.getElementById("file-size"),btnRemoveFile:document.getElementById("btn-remove-file"),btnAnalyzeFile:document.getElementById("btn-analyze-file"),processingStatus:document.getElementById("processing-status"),processingStep:document.getElementById("processing-step"),progressBar:document.getElementById("progress-bar"),transcriptionPanel:document.getElementById("transcription-panel"),transcriptionText:document.getElementById("transcription-text"),detectedLanguage:document.getElementById("detected-language"),transcriptionTime:document.getElementById("transcription-time"),sentimentPanel:document.getElementById("sentiment-panel"),emotionEmoji:document.getElementById("emotion-emoji"),emotionLabel:document.getElementById("emotion-label"),emotionConfidence:document.getElementById("emotion-confidence"),emotionBars:document.getElementById("emotion-bars"),emptyState:document.getElementById("empty-state"),errorPanel:document.getElementById("error-panel"),errorMessage:document.getElementById("error-message"),btnRetry:document.getElementById("btn-retry")};let t=!1,n=null,o=[],l=null,i=null,r=null,a=null,d=null,s=null,c=null,u=null,m=null;const g={joy:{emoji:"üòä",color:"#22c55e"},sadness:{emoji:"üò¢",color:"#3b82f6"},anger:{emoji:"üò†",color:"#ef4444"},fear:{emoji:"üò®",color:"#a855f7"},love:{emoji:"‚ù§Ô∏è",color:"#ec4899"},surprise:{emoji:"üòÆ",color:"#f59e0b"}};function p(t){const n="file"===t;e.btnRecordFile&&(e.btnRecordFile.className=n?"mode-btn active p-4 rounded-xl bg-purple-600 transition-all text-center border-2 border-purple-500":"mode-btn p-4 rounded-xl bg-white/10 hover:bg-white/20 transition-all text-center border-2 border-transparent"),e.btnRecordMic&&(e.btnRecordMic.className=n?"mode-btn p-4 rounded-xl bg-white/10 hover:bg-white/20 transition-all text-center border-2 border-transparent":"mode-btn active p-4 rounded-xl bg-purple-600 transition-all text-center border-2 border-purple-500"),e.panelFileUpload&&(e.panelFileUpload.style.display=n?"block":"none"),e.panelMicRecording&&(e.panelMicRecording.style.display=n?"none":"block")}function y(t,n){if(!e.connectionStatus)return;const o={ready:{class:"bg-gray-500/20 text-gray-400",pulse:""},recording:{class:"bg-red-500/20 text-red-400",pulse:"animate-pulse"},processing:{class:"bg-yellow-500/20 text-yellow-400",pulse:""},success:{class:"bg-green-500/20 text-green-400",pulse:""},demo:{class:"bg-blue-500/20 text-blue-400",pulse:""}},l=o[t]||o.ready;e.connectionStatus.className=`inline-flex items-center px-3 py-1 rounded-full text-sm ${l.class}`,e.connectionStatus.innerHTML=`\n    <span class="w-2 h-2 ${l.pulse} rounded-full mr-2" style="background: currentColor"></span>\n    ${n}\n  `}async function f(){var d,s,m;try{l=await navigator.mediaDevices.getUserMedia({audio:!0}),function(n){const o=e.audioVisualizer;if(!o)return;i=new(window.AudioContext||window.webkitAudioContext),r=i.createAnalyser();i.createMediaStreamSource(n).connect(r),r.fftSize=128;const l=o.getContext("2d"),d=new Uint8Array(r.frequencyBinCount);function s(){if(!t)return;a=requestAnimationFrame(s),r.getByteFrequencyData(d),l.fillStyle="#1e293b",l.fillRect(0,0,o.width,o.height);const e=o.width/d.length;for(let t=0;t<d.length;t++){const n=d[t]/2;l.fillStyle=`hsl(${t/d.length*60+200}, 70%, 60%)`,l.fillRect(t*e,o.height-n,e-1,n)}}s()}(l),n=new MediaRecorder(l),o=[],n.ondataavailable=e=>{e.data.size>0&&o.push(e.data)},n.start(100),t=!0,c=Date.now(),null==(d=e.btnStartRecording)||d.classList.add("hidden"),null==(s=e.btnStopRecording)||s.classList.remove("hidden"),e.recordingStatus.textContent="Recording... Speak now!",null==(m=e.recordingDuration)||m.classList.remove("hidden"),e.btnAnalyzeStream.disabled=!0,u=setInterval(v,100),y("recording","Recording...")}catch(g){alert("Cannot access microphone. Please allow microphone access.")}}function b(){n&&(n.onstop=()=>{var t,n;s=new Blob(o,{type:"audio/webm"}),h(),null==l||l.getTracks().forEach(e=>e.stop()),clearInterval(u),null==(t=e.btnStartRecording)||t.classList.remove("hidden"),null==(n=e.btnStopRecording)||n.classList.add("hidden"),e.recordingStatus.textContent="Recording complete!",e.btnAnalyzeStream.disabled=!1,y("ready","Ready - Click Analyze")},setTimeout(()=>n.stop(),200))}function h(){a&&cancelAnimationFrame(a),i&&i.close(),a=null,i=null}function v(){if(!c)return;const t=Date.now()-c,n=Math.floor(t/1e3),o=`${Math.floor(n/60).toString().padStart(2,"0")}:${(n%60).toString().padStart(2,"0")}`;e.recTime.textContent=o}function E(t){var n,o;const l=t.target.files[0];l&&(d=l,null==(n=e.fileInfo)||n.classList.remove("hidden"),e.fileName.textContent=l.name,e.fileSize.textContent=`${(l.size/1024/1024).toFixed(2)} MB`,null==(o=e.dropZone)||o.classList.add("hidden"),e.btnAnalyzeFile.disabled=!1)}function x(){var t,n;d=null,e.fileInput.value="",null==(t=e.fileInfo)||t.classList.add("hidden"),null==(n=e.dropZone)||n.classList.remove("hidden"),e.btnAnalyzeFile.disabled=!0}async function I(){d&&(w("Analyzing audio..."),await B("Sample audio transcription text"))}async function S(){s&&(w("Analyzing recording..."),await B("Transcribed speech from recording"))}async function B(t){await new Promise(e=>setTimeout(e,1500));const n={},o=Object.keys(g);let l=1;o.forEach((e,t)=>{if(t===o.length-1)n[e]=l;else{const t=Math.random()*(.5*l);n[e]=t,l-=t}});const i=o[Math.floor(Math.random()*o.length)];n[i]=Math.max(n[i],.5);const r=Object.values(n).reduce((e,t)=>e+t,0);Object.keys(n).forEach(e=>n[e]/=r),function(t){var n,o,l,i,r;null==(n=e.emptyState)||n.classList.add("hidden"),null==(o=e.errorPanel)||o.classList.add("hidden"),null==(l=e.transcriptionPanel)||l.classList.remove("hidden"),null==(i=e.sentimentPanel)||i.classList.remove("hidden"),e.transcriptionText.textContent=t.text,e.transcriptionTime.textContent=`${t.processing_time_seconds}s`;const a=t.sentiment;e.emotionLabel.textContent=a.label.toUpperCase(),e.emotionEmoji.textContent=(null==(r=g[a.label])?void 0:r.emoji)||"üòê",e.emotionConfidence.textContent=`${(100*a.score).toFixed(1)}%`,L(t.all_emotions),function(t){const n=Object.entries(t).sort((e,t)=>t[1]-e[1]);e.emotionBars.innerHTML=n.map(([e,t])=>{var n;return`\n    <div class="flex items-center gap-2">\n      <span class="w-20 text-sm capitalize">${e}</span>\n      <div class="flex-1 bg-gray-700 rounded-full h-2 overflow-hidden">\n        <div class="h-full rounded-full transition-all duration-500" \n             style="width: ${100*t}%; background: ${null==(n=g[e])?void 0:n.color}"></div>\n      </div>\n      <span class="w-12 text-right text-sm text-gray-400">${(100*t).toFixed(0)}%</span>\n    </div>\n  `}).join("")}(t.all_emotions)}({text:t||"(Recording analyzed)",sentiment:{label:i,score:n[i]},all_emotions:n,processing_time_seconds:1.5}),e.progressBar.style.width="100%",setTimeout(()=>{var t;return null==(t=e.processingStatus)?void 0:t.classList.add("hidden")},300),y("success","Analysis complete!")}function L(e){const t=["joy","sadness","anger","fear","love","surprise"].map(t=>e[t]||0);m.data.datasets[0].data=t,m.update()}function w(t){var n;null==(n=e.processingStatus)||n.classList.remove("hidden"),e.processingStep.textContent=t,e.progressBar.style.width="0%";let o=0;const l=setInterval(()=>{o+=5,e.progressBar.style.width=`${o}%`,o>=90&&clearInterval(l)},100)}function R(){var t,n,o,i,r,a,d;x(),s=null,clearInterval(u),h(),null==l||l.getTracks().forEach(e=>e.stop()),null==(t=e.btnStartRecording)||t.classList.remove("hidden"),null==(n=e.btnStopRecording)||n.classList.add("hidden"),e.btnAnalyzeStream.disabled=!0,e.recordingStatus.textContent="Click the microphone to start recording",null==(o=e.recordingDuration)||o.classList.add("hidden"),e.recTime.textContent="00:00",null==(i=e.transcriptionPanel)||i.classList.add("hidden"),null==(r=e.sentimentPanel)||r.classList.add("hidden"),null==(a=e.errorPanel)||a.classList.add("hidden"),null==(d=e.emptyState)||d.classList.remove("hidden"),L({joy:0,sadness:0,anger:0,fear:0,love:0,surprise:0}),y("ready","Ready")}document.addEventListener("DOMContentLoaded",function(){var t,n,o,l,i,r,a,d,s,c;null==(t=e.btnRecordFile)||t.addEventListener("click",()=>p("file")),null==(n=e.btnRecordMic)||n.addEventListener("click",()=>p("mic")),null==(o=e.btnStartRecording)||o.addEventListener("click",f),null==(l=e.btnStopRecording)||l.addEventListener("click",b),null==(i=e.dropZone)||i.addEventListener("click",()=>{var t;return null==(t=e.fileInput)?void 0:t.click()}),null==(r=e.fileInput)||r.addEventListener("change",E),null==(a=e.btnRemoveFile)||a.addEventListener("click",x),null==(d=e.btnAnalyzeFile)||d.addEventListener("click",I),null==(s=e.btnAnalyzeStream)||s.addEventListener("click",S),null==(c=e.btnRetry)||c.addEventListener("click",R),function(){const e=document.getElementById("emotions-chart");if(!e)return;const t=e.getContext("2d");m=new Chart(t,{type:"doughnut",data:{labels:["Joy","Sadness","Anger","Fear","Love","Surprise"],datasets:[{data:[0,0,0,0,0,0],backgroundColor:Object.values(g).map(e=>e.color+"80"),borderColor:Object.values(g).map(e=>e.color),borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"60%",plugins:{legend:{display:!1}}}})}(),y("ready","Ready - Click Live Recording")});
